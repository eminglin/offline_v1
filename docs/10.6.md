#### 鄂明霖 0928
-- 1. 切换数据库
CREATE DATABASE IF NOT EXISTS ods_hbase;
USE ods_hbase;

-- 2. 删除原有表（若存在）
DROP TABLE IF EXISTS order_info_hive;

-- 3. 创建无分区的 HBase 映射表
CREATE EXTERNAL TABLE order_info_hive (
rowkey STRING,          -- HBase 的 RowKey
order_id STRING,        -- HBase 列 cf:order_id
create_time STRING,     -- HBase 列 cf:create_time
amount STRING,          -- HBase 列 cf:amount
status STRING           -- HBase 列 cf:status
)
-- 关键：不设置 PARTITIONED BY，避免分区冲突
STORED BY 'org.apache.hadoop.hive.hbase.HBaseStorageHandler'
WITH SERDEPROPERTIES (
-- 映射关系：Hive列 → HBase列（:key 代表RowKey）
"hbase.columns.mapping" = ":key,cf:order_id,cf:create_time,cf:amount,cf:status"
)
TBLPROPERTIES (
"hbase.table.name" = "ods:order_info",  -- 关联的 HBase 表名
"hbase.client.scanner.caching" = "500"  -- 扫描缓存，提升查询效率
);


-- 1. 查询 HBase 预分区 hash_00 的数据（RowKey 以 hash_00| 开头）
SELECT rowkey, order_id, create_time, amount, status
FROM order_info_hive
WHERE rowkey LIKE 'hash_00|%';  -- 前缀过滤，命中 HBase hash_00 分区

-- 2. 查询 HBase 预分区 hash_01 的数据
SELECT rowkey, order_id, create_time, amount, status
FROM order_info_hive
WHERE rowkey LIKE 'hash_01|%';

-- 3. 结合时间范围查询（RowKey 含时间戳，二次过滤）
SELECT rowkey, order_id, amount, status
FROM order_info_hive
WHERE rowkey LIKE 'hash_02|%'  -- 先命中 HBase hash_02 分区
AND create_time BETWEEN '2025-10-01 00:00:00' AND '2025-10-02 23:59:59';  -- 时间过滤



select *
from order_info_hive;